FROM python:3.9-slim

USER root
COPY . .

WORKDIR .
RUN apt-get update
RUN apt-get install libpq-dev -y
RUN pip install uvicorn fastapi psycopg2-binary \
    pydantic python-decouple pytest pytest-cov httpx

ENV PYTHONPATH=.
ENV DB_HOST=postgres
ENV DB_PORT=5432
ENV DB_NAME=postgres
ENV DB_USER=postgres
ENV DB_PASS=1234

RUN pytest -vv tests/ --cov=app --cov-report=html

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "80"]
